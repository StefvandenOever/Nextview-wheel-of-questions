<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Nextview Wheel of Questions — Party Mode (No‑CDN Confetti)</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"
            integrity="sha256-eTPiE7OfNDSwTrJNIZ8nlZapx9n3gz9+Oo2zzr5+adM="
            crossorigin="anonymous"
            onerror="this.removeAttribute('integrity'); this.src='vendor/tailwindcss.js';"></script>
    <script>tailwind.config = { theme: { extend: {
      keyframes: {
        huepulse: { '0%, 100%': { filter: 'hue-rotate(0deg)' }, '50%': { filter: 'hue-rotate(45deg)' } },
        floaty: { '0%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-10px)' }, '100%': { transform: 'translateY(0px)' } },
        shimmer: { '0%': { backgroundPosition: '0% 50%' }, '100%': { backgroundPosition: '100% 50%' } }
      },
      animation: {
        huepulse: 'huepulse 6s ease-in-out infinite',
        floaty: 'floaty 4s ease-in-out infinite',
        shimmer: 'shimmer 12s linear infinite'
      }
    } } };</script>

    <!-- React + ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"
            integrity="sha256-S0lp+k7zWUMk2ixteM6HZvu8L9Eh//OVrt+ZfbCpmgY="
            crossorigin="anonymous"
            onerror="this.removeAttribute('integrity'); this.src='vendor/react.production.min.js';"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
            integrity="sha256-IXWO0ITNDjfnNXIu5POVfqlgYoop36bDzhodR6LW5Pc="
            crossorigin="anonymous"
            onerror="this.removeAttribute('integrity'); this.src='vendor/react-dom.production.min.js';"></script>

    <!-- Babel Standalone (compile JSX in-browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"
            integrity="sha256-3jyRlQ0KMnYi6xl+R2rZQ5JO1xam48suhyxFJgS/Ups="
            crossorigin="anonymous"
            onerror="this.removeAttribute('integrity'); this.src='vendor/babel.min.js';"></script>

    <!-- framer-motion (UMD) -->
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"
            integrity="sha256-OCEzkN+dIx4tkYIBp41/w69A+VAJqPD1wGImv1vXAw4="
            crossorigin="anonymous"
            onerror="this.removeAttribute('integrity'); this.src='vendor/framer-motion.js';"></script>

    <style>
      html, body, #root { height: 100%; }
      body { background: linear-gradient(135deg, #fae8ff, #ffe4e6, #fde68a); background-size: 300% 300%; }
      .party-bg { position: fixed; inset: -20vmax;
        background: radial-gradient(60vmax 60vmax at 10% 10%, rgba(255,255,255,.35), transparent 60%),
                    radial-gradient(60vmax 60vmax at 90% 30%, rgba(255,255,255,.25), transparent 60%),
                    radial-gradient(60vmax 60vmax at 50% 90%, rgba(255,255,255,.2), transparent 60%);
        pointer-events: none; z-index: 0;
      }
      #error-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.6); color: #fff; display: none; align-items: center; justify-content: center; padding: 24px; z-index: 99999; }
      #error-overlay .box { max-width: 900px; width: 100%; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.3); border-radius: 16px; padding: 20px; }
      #error-overlay pre { white-space: pre-wrap; word-break: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>
  <body class="min-h-screen">
    <div class="party-bg animate-shimmer"></div>
    <div id="root"></div>

    <!-- Our own ultra-high-layer confetti canvas (no external lib) -->
    <canvas id="party-canvas" style="position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:2147483647"></canvas>

    <!-- Friendly error overlay -->
    <div id="error-overlay"><div class="box">
      <div class="mb-2 font-semibold">An error occurred:</div>
      <pre id="error-text"></pre>
      <div class="text-xs opacity-80 mt-2">Open the browser console for details.</div>
    </div></div>
    <script>
      (function(){
        const overlay = document.getElementById('error-overlay');
        const txt = document.getElementById('error-text');
        window.addEventListener('error', (e) => {
          try { txt.textContent = String(e.error ? (e.error.stack || e.error) : e.message || e); } catch { txt.textContent = 'Unknown error'; }
          overlay.style.display = 'flex';
        });
        window.addEventListener('unhandledrejection', (e) => {
          try { txt.textContent = String(e.reason && e.reason.stack ? e.reason.stack : e.reason || e); } catch { txt.textContent = 'Unknown promise rejection'; }
          overlay.style.display = 'flex';
        });
      })();
    </script>

    <!-- App (compiled by Babel in the browser) -->
    <script type="text/babel" data-presets="env,react" defer>
      const { useEffect, useMemo, useState } = React;
      const FM = window.framerMotion || window.FramerMotion || window.framermotion || null;
      const motion = FM ? FM.motion : new Proxy({}, { get: () => (props) => React.createElement('div', props, props && props.children) });
      const AnimatePresence = FM ? FM.AnimatePresence : ({ children }) => React.createElement(React.Fragment, null, children);

      // ---- Zero-dependency confetti engine (Canvas 2D) ----
      class ConfettiEngine {
        constructor(canvas){
          this.canvas = canvas;
          this.ctx = canvas.getContext('2d');
          this.dpr = Math.max(1, window.devicePixelRatio || 1);
          this.particles = [];
          this.running = false;
          this._resize = this.resize.bind(this);
          this.resize();
          window.addEventListener('resize', this._resize);
          document.addEventListener('visibilitychange', () => {
            if (document.hidden) this.stop(); else this.start();
          });
          this.colors = ["#ef4444","#f59e0b","#10b981","#3b82f6","#a855f7","#ec4899","#22c55e","#eab308"];
        }
        resize(){
          const { canvas, dpr } = this;
          const rect = canvas.getBoundingClientRect();
          canvas.width = Math.floor(rect.width * dpr);
          canvas.height = Math.floor(rect.height * dpr);
        }
        addBurst({ x=0.5, y=0.5, count=150, spread=Math.PI/2, speed=8, scalar=1 }){
          const { width, height } = this.canvas;
          for(let i=0;i<count;i++){
            const angle = (Math.random() * spread) + (Math.PI/2 - spread/2);
            const v = speed * (0.6 + Math.random()*0.8);
            this.particles.push({
              x: x*width, y: y*height,
              vx: Math.cos(angle) * v, vy: Math.sin(angle) * v * -1,
              g: 0.18 + Math.random()*0.28,
              w: 4*scalar + Math.random()*4*scalar,
              h: 8*scalar + Math.random()*8*scalar,
              rot: Math.random()*Math.PI,
              vr: (Math.random() - 0.5) * 0.3,
              alpha: 1,
              fade: 0.007 + Math.random()*0.01,
              color: this.colors[(Math.random()*this.colors.length)|0]
            });
          }
          this.start();
        }
        addCannon({ side='left' }){
          const x = side==='left' ? 0.12 : 0.88;
          this.addBurst({ x, y: 0.7, count: 180, spread: Math.PI/3, speed: 10, scalar: 1.1 });
        }
        addRain({ count=60 }){
          const { width } = this.canvas;
          for(let i=0;i<count;i++){
            this.particles.push({
              x: Math.random()*width, y: -20,
              vx: (Math.random()-0.5)*1.2, vy: 6 + Math.random()*3,
              g: 0.04,
              w: 3 + Math.random()*3,
              h: 10 + Math.random()*14,
              rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.08,
              alpha: 0.9, fade: 0.004 + Math.random()*0.006,
              color: this.colors[(Math.random()*this.colors.length)|0]
            });
          }
          this.start();
        }
        addComet(){
          const { width, height } = this.canvas;
          const startX = Math.random()*width*0.3;
          const startY = Math.random()*height*0.2;
          for(let i=0;i<28;i++){
            this.particles.push({
              x: startX - i*8, y: startY + i*5,
              vx: 6, vy: 2,
              g: 0.06,
              w: 3, h: 3,
              rot: 0, vr: 0.02,
              alpha: 1 - i*0.03, fade: 0.01,
              color: this.colors[(Math.random()*this.colors.length)|0]
            });
          }
          this.start();
        }
        start(){
          if (this.running) return;
          this.running = true;
          let last = performance.now();
          const step = (now) => {
            if (!this.running) return;
            const dt = Math.min(32, now - last); last = now;
            this.update(dt);
            this.draw();
            if (this.particles.length > 0) requestAnimationFrame(step);
            else this.running = false;
          };
          requestAnimationFrame(step);
        }
        stop(){ this.running = false; }
        update(dt){
          const gdt = dt/16.6;
          const { width, height } = this.canvas;
          this.particles = this.particles.filter(p => {
            p.vy += p.g * gdt;
            p.x += p.vx * gdt;
            p.y += p.vy * gdt;
            p.rot += p.vr * gdt;
            p.alpha -= p.fade * gdt;
            return p.alpha > 0 && p.y < height + 40 && p.x > -40 && p.x < width + 40;
          });
        }
        draw(){
          const { ctx, canvas } = this;
          const dpr = this.dpr;
          ctx.clearRect(0,0,canvas.width,canvas.height);
          ctx.save();
          ctx.globalCompositeOperation = 'source-over';
          for(const p of this.particles){
            ctx.globalAlpha = Math.max(0, Math.min(1, p.alpha));
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.setTransform(1,0,0,1,0,0);
          }
          ctx.restore();
        }
        megaShow(duration=4200){
          const end = Date.now() + duration;
          const loop = () => {
            this.addRain({ count: 6 });
            if (Math.random() < 0.18) this.addComet();
            if (Date.now() < end) requestAnimationFrame(loop);
          };
          this.addCannon({ side:'left' }); this.addCannon({ side:'right' });
          this.addBurst({ x:0.5, y:0.35, count:180, spread:Math.PI*1.2, speed:9, scalar:1.2 });
          loop();
        }
      }
      const PARTY = new ConfettiEngine(document.getElementById('party-canvas'));

      // ---- App UI (slots + editors) ----
      const STORAGE_KEYS = { team: "woq_team_v4", questions: "woq_questions_v1", settings: "woq_settings_v7" };
      const DEFAULT_QUESTIONS = [
        "😀 What’s a small thing that made you smile recently?",
        "🍝 What’s your go-to comfort food?",
        "🎬 What’s a movie you can quote from memory?",
        "🌅 Morning person or night owl?",
        "🎵 What’s a song that’s been stuck in your head?"
      ];
      const DEFAULT_TEAM = ["Alex","Jamie","Sam","Taylor"];

      class SoundEngine {
        constructor(){ this.ctx = null; }
        async unlock() {
          if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          if (this.ctx.state === "suspended") await this.ctx.resume();
          const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
          g.gain.value = 0.0001; o.connect(g).connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + 0.01);
        }
        tone({ freq = 880, dur = 0.08, type = "sine", vol = 0.06 } = {}) {
          if (!this.ctx) return;
          const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
          o.type = type; o.frequency.value = freq; o.connect(g).connect(this.ctx.destination);
          const now = this.ctx.currentTime;
          g.gain.setValueAtTime(vol, now); g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
          o.start(now); o.stop(now + dur);
        }
        tick(){ this.tone({ freq: 900, dur: 0.06, type: "triangle", vol: 0.05 }); }
        win(){ [660,880,1320].forEach((f,i)=>setTimeout(()=>this.tone({freq:f,dur:0.09,type:"sine",vol:0.06}), i*90)); }
        crazy(){ [220,330,440,550,660,770,880].forEach((f,i)=>setTimeout(()=>this.tone({freq:f,dur:0.05,type:"square",vol:0.07}), i*50)); }
      }
      const SFX = new SoundEngine();

      const Icon = ({ label, className, children }) => (<span aria-label={label} role="img" className={`inline-block align-middle ${className??""}`}>{children}</span>);
      const Icons = {
        party: (cls) => <Icon label="party" className={cls}>🎉</Icon>,
        users: (cls) => <Icon label="users" className={cls}>👥</Icon>,
        plus: (cls) => <Icon label="add" className={cls}>＋</Icon>,
        trash: (cls) => <Icon label="Remove" className={cls}>🗑️</Icon>,
        shuffle: (cls) => <Icon label="shuffle" className={cls}>🔀</Icon>,
        volOn: (cls) => <Icon label="volume on" className={cls}>🔊</Icon>,
        volOff: (cls) => <Icon label="volume off" className={cls}>🔇</Icon>,
        download: (cls) => <Icon label="download" className={cls}>⬇️</Icon>,
        upload: (cls) => <Icon label="upload" className={cls}>⬆️</Icon>,
        eye: (cls) => <Icon label="eye" className={cls}>👁️</Icon>,
        eyeOff: (cls) => <Icon label="hide" className={cls}>🙈</Icon>,
        monitor: (cls) => <Icon label="test sound" className={cls}>📱</Icon>,
        boom: (cls) => <Icon label="boom" className={cls}>💥</Icon>,
      };

      function Panel({ title, icon, children }){
        return (
          <div className="relative rounded-3xl bg-white/70 backdrop-blur border border-white/30 shadow-xl p-5 overflow-hidden">
            <div className="absolute -inset-32 bg-[conic-gradient(from_0deg,rgba(255,255,255,.25),transparent_30%,transparent_70%,rgba(255,255,255,.25))] animate-huepulse opacity-40"></div>
            <div className="relative flex items-center gap-2 mb-4">{icon}<h2 className="text-lg font-semibold">{title}</h2></div>
            <div className="relative">{children}</div>
          </div>
        );
      }

      function TeamManager({ team, onToggle, onAdd, onRemove, onSetAll }){
        const [name, setName] = useState("");
        const presentCount = team.filter(t => t.present).length;
        return (
          <div className="space-y-4">
            <div className="flex gap-2">
              <input value={name} onChange={(e) => setName(e.target.value)} onKeyDown={(e) => { if (e.key === "Enter") { onAdd(name); setName(""); } }} placeholder="Add teammate name" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-amber-400" />
              <button type="button" onClick={() => { onAdd(name); setName(""); }} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-amber-500 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
            </div>
            <div className="flex justify-between items-center text-sm text-slate-600">
              <span>Present: <strong>{presentCount}</strong> / {team.length}</span>
              <div className="flex gap-2">
                <button type="button" onClick={() => onSetAll(true)} className="px-3 py-1 rounded-full bg-emerald-500/90 text-white text-xs shadow">All present</button>
                <button type="button" onClick={() => onSetAll(false)} className="px-3 py-1 rounded-full bg-slate-400/90 text-white text-xs shadow">All away</button>
              </div>
            </div>
            <div className="max-h-[380px] overflow-auto pr-1">
              <ul className="divide-y divide-white/40">
                {team.map(p => (
                  <li key={p.id} className="flex items-center gap-3 py-2">
                    <input type="checkbox" checked={p.present} onChange={() => onToggle(p.id)} className="accent-emerald-600 w-4 h-4" />
                    <span className={`flex-1 ${p.present ? "" : "opacity-50"}`}>{p.name}</span>

                    <button type="button" onClick={() => onRemove(p.id)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove" aria-label="Remove">{Icons.trash("text-base")}</button>
=======
                    <button onClick={() => onRemove(p.id)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove" aria-label="Remove">{Icons.trash("text-base")}</button>

                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      
      function SlotCard({ bigText, smallText, emoji, highlight=false, spotlight=false, spotlightIcon='👑', spotlightSubtitle='On the spot!', spotlightShowBig=true }){
        return (
          <div className="relative flex-1">
            <div className={`relative w-full min-h-[240px] sm:min-h-[260px] rounded-3xl p-4 sm:p-6 bg-white/90 backdrop-blur border border-white/40 shadow-2xl ring-4 ${highlight ? 'ring-amber-300/70' : 'ring-white/30'}`}>
              <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_20%_20%,rgba(255,255,255,.6),transparent_40%),radial-gradient(circle_at_80%_30%,rgba(255,255,255,.35),transparent_45%)] rounded-3xl" />
              <div className="relative flex items-stretch gap-4 h-full">
                <div className="self-stretch flex-shrink-0 w-20 sm:w-24 flex items-center justify-center rounded-2xl bg-slate-100/80 border border-white/40 text-5xl select-none animate-floaty">
                  {emoji || '🎰'}
                </div>
                <div className="flex-1 grid place-items-center text-center px-2">
                  <div className="w-full">
                    {React.createElement(motion.div || 'div', {
                      key: bigText,
                      initial: { y: 8, opacity: 0, rotate: -0.5 },
                      animate: { y: 0, opacity: 1, rotate: 0 },
                      transition: { type: 'spring', stiffness: 500, damping: 30 },
                      className: "text-3xl sm:text-5xl md:text-6xl font-extrabold tracking-tight leading-tight md:leading-snug whitespace-pre-wrap break-words"
                    }, bigText)}
                    {smallText && React.createElement(motion.div || 'div', {
                      key: smallText,
                      initial: { opacity: 0 },
                      animate: { opacity: 1 },
                      transition: { duration: 0.25 },
                      className: "mt-3 text-slate-600 text-base sm:text-lg whitespace-pre-wrap break-words"
                    }, smallText)}
                  </div>
                </div>
              </div>
            </div>

            {React.createElement(AnimatePresence, null,
              spotlight ? React.createElement('div', { className:"absolute inset-0 rounded-3xl bg-black/40 backdrop-blur-sm flex items-center justify-center z-10" },
                React.createElement(motion.div || 'div', {
                  initial:{ scale: 0.9, rotate: -2 },
                  animate:{ scale: 1, rotate: 0 },
                  exit:{ scale: 0.95, opacity: 0 },
                  transition:{ type: 'spring', stiffness: 280, damping: 20 },
                  className:"px-8 py-6 rounded-3xl bg-white/95 border border-white/40 shadow-2xl text-center"
                },
                  React.createElement('div', { className:"text-5xl mb-2" }, spotlightIcon),
                  spotlightShowBig ? React.createElement('div', { className:"text-2xl font-extrabold tracking-wide" }, bigText) : null,
                  React.createElement('div', { className:"mt-2 text-sm text-slate-500" }, spotlightSubtitle)
                )
              ) : null
            )}
          </div>
        );
      }
function QuestionsEditor({ questions, setQuestions }){
        const [draft, setDraft] = useState("");
        function addQuestion(q){ const t = (q||"").trim(); if (!t) return; setQuestions([t, ...questions]); setDraft(""); }
        function removeQuestion(idx){ setQuestions(questions.filter((_, i) => i !== idx)); }
        function resetDefaults(){ if (confirm("Replace all questions with the default set?")) setQuestions(DEFAULT_QUESTIONS); }
        return (
          <div className="space-y-3">
            <div className="flex gap-2">
              <input value={draft} onChange={(e) => setDraft(e.target.value)} onKeyDown={(e) => e.key === "Enter" && addQuestion(draft)} placeholder="Add a question (tip: start with an emoji!)" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-fuchsia-400" />
              <button type="button" onClick={() => addQuestion(draft)} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-fuchsia-600 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
            </div>
            <div className="flex justify-between items-center text-sm text-slate-600">
              <span>{questions.length} questions</span>
              <button type="button" onClick={resetDefaults} className="px-3 py-1 rounded-full bg-slate-500/90 text-white text-xs shadow">Reset defaults</button>
            </div>
            <div className="max-h-[380px] overflow-auto pr-1">
              <ul className="divide-y divide-white/40">
                {questions.map((q, i) => (
                  <li key={i} className="flex items-start gap-3 py-2">
                    <span className="text-slate-500 text-xs mt-1">{i + 1}.</span>
                    <span className="flex-1 text-sm">{q}</span>

                    <button type="button" onClick={() => removeQuestion(i)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove" aria-label="Remove">{Icons.trash("text-base")}</button>
=======
                    <button onClick={() => removeQuestion(i)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove" aria-label="Remove">{Icons.trash("text-base")}</button>

                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      function App(){
        const [team, setTeam] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.team);
          if (raw) {
            try { return JSON.parse(raw); }
            catch { localStorage.removeItem(STORAGE_KEYS.team); }
          }
          const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
          return DEFAULT_TEAM.map(n => ({ id: id(), name: n, present: true }));
        });
        const [questions, setQuestions] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.questions);
          if (raw) {
            try { return JSON.parse(raw); }
            catch { localStorage.removeItem(STORAGE_KEYS.questions); }
          }
          return DEFAULT_QUESTIONS;
        });
        const [settings, setSettings] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.settings);
          if (raw) {
            try { return JSON.parse(raw); }
            catch { localStorage.removeItem(STORAGE_KEYS.settings); }
          }
          return { sfx: true, showTeam: false, showQuestions: false, party: true };
        });

        const [selectedPerson, setSelectedPerson] = useState(null);
        const [selectedQuestion, setSelectedQuestion] = useState(null);

        const [slotPersonRunning, setSlotPersonRunning] = useState(false);
        const [slotQuestionRunning, setSlotQuestionRunning] = useState(false);

        const [slotName, setSlotName] = useState("");
        const [slotText, setSlotText] = useState("");

        const [showSpotlight, setShowSpotlight] = useState(false);
        const [showQSpotlight, setShowQSpotlight] = useState(false);

        useEffect(() => { localStorage.setItem(STORAGE_KEYS.team, JSON.stringify(team)); }, [team]);
        useEffect(() => { localStorage.setItem(STORAGE_KEYS.questions, JSON.stringify(questions)); }, [questions]);
        useEffect(() => { localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings)); }, [settings]);
        useEffect(() => {
          const handler = () => { SFX.unlock().catch(()=>{}); };
          window.addEventListener("pointerdown", handler, { once: true });
          return () => window.removeEventListener("pointerdown", handler);
        }, []);

        const presentTeam = useMemo(() => team.filter(t => t.present), [team]);

        function pickRandomPersonSlot(){
          if (!presentTeam.length || slotPersonRunning) return;
          setSelectedQuestion(null);
          setSlotPersonRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const p = presentTeam[i % presentTeam.length];
            setSlotName(p.name);
            if (settings.sfx) SFX.tick();
            if (settings.party && Math.random() < 0.18) PARTY.addRain({ count: 4 });
            i++;
          }, 70);
          const stopAfter = Math.floor(Math.random()*800) + 1800;
          setTimeout(() => {
            clearInterval(interval);
            const final = presentTeam[Math.floor(Math.random()*presentTeam.length)];
            setSlotName(final.name);
            setSelectedPerson(final);
            setSlotPersonRunning(false);
            setShowSpotlight(true);
            if (settings.party) PARTY.megaShow(4800);
            if (settings.sfx) { SFX.win(); SFX.crazy(); }
            setTimeout(() => setShowSpotlight(false), 2600);
          }, stopAfter);
        }

        function pickRandomQuestionSlot(){
          if (!questions.length || slotQuestionRunning) return;
          setSlotQuestionRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const q = questions[i % questions.length];
            setSlotText(q);
            if (settings.sfx) SFX.tick();
            if (settings.party && Math.random() < 0.18) PARTY.addRain({ count: 4 });
            i++;
          }, 70);
          const stopAfter = Math.floor(Math.random()*800) + 1800;
          setTimeout(() => {
            clearInterval(interval);
            const index = Math.floor(Math.random()*questions.length);
            const final = questions[index];
            setSlotText(final);
            setSelectedQuestion(final);
            setSlotQuestionRunning(false);
            setShowQSpotlight(true);
            if (settings.party) PARTY.megaShow(5000);
            if (settings.sfx) { SFX.win(); SFX.crazy(); }
            setTimeout(() => setShowQSpotlight(false), 2600);
          }, stopAfter);
        }

        function importData(file){
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const payload = JSON.parse(String(reader.result));
              if (Array.isArray(payload.team)) {
                const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
                setTeam(payload.team.map(n => ({
                  id: id(),
                  name: String(n.name ?? n),
                  present: Boolean(n.present ?? true)
                })));
              }
              if (Array.isArray(payload.questions)) setQuestions(payload.questions.map(String));
            } catch {
              alert("Couldn’t import JSON. Make sure it contains { team: [], questions: [] }...");
            }
          };
          reader.readAsText(file);
        }

        function exportData(){
          const blob = new Blob([JSON.stringify({ team: team.map(({ name, present }) => ({ name, present })), questions }, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "wheel-of-questions.json"; a.click(); URL.revokeObjectURL(url);
        }

        const layoutCols = settings.showTeam && settings.showQuestions ? "lg:grid-cols-3" : (settings.showTeam || settings.showQuestions) ? "lg:grid-cols-2" : "lg:grid-cols-1";

        return (
          <div className="min-h-screen w-full text-slate-800 relative">
            <header className={`sticky top-0 z-30 backdrop-blur ${settings.party ? 'bg-gradient-to-r from-rose-200/60 via-amber-200/60 to-lime-200/60' : 'bg-white/40'} border-b border-white/20`}>
              <div className="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
                <img src="nextview-logo.png" alt="Nextview Consulting" className={`h-7 object-contain ${settings.party ? 'animate-huepulse' : ''}`} />
                <h1 className="text-xl font-semibold">Nextview Wheel of Questions</h1>
                <span className="ml-auto flex items-center gap-2">
                  <button type="button" onMouseDown={() => SFX.unlock()} onClick={() => setSettings(s => ({ ...s, sfx: !s.sfx }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.sfx ? "Disable sounds" : "Enable sounds"}>
                    {settings.sfx ? "🔊" : "🔇"}<span className="text-sm">SFX</span>
                  </button>
                  <button type="button" onClick={() => { SFX.unlock(); settings.sfx && SFX.tick(); }} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Test sound">
                    📱<span className="text-sm">Test</span>
                  </button>
                  <button type="button" onClick={() => setSettings(s => ({ ...s, showTeam: !s.showTeam }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showTeam ? "Hide team" : "Show team"}>
                    {settings.showTeam ? "🙈" : "👁️"}<span className="text-sm">Team</span>
                  </button>
                  <button type="button" onClick={() => setSettings(s => ({ ...s, showQuestions: !s.showQuestions }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showQuestions ? "Hide questions" : "Show questions"}>
                    {settings.showQuestions ? "🙈" : "👁️"}<span className="text-sm">Questions</span>
                  </button>
                  <button type="button" onClick={exportData} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Export team & questions">
                    ⬇️<span className="text-sm">Export</span>
                  </button>
                  <label className="cursor-pointer inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition">
                    ⬆️<span className="text-sm">Import</span>
                    <input type="file" accept="application/json" className="hidden" onChange={(e) => e.target.files && importData(e.target.files[0])} />
                  </label>
                  <button type="button" onClick={() => setSettings(s => ({ ...s, party: !s.party }))} className={`inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 shadow hover:shadow-lg transition ${settings.party ? 'bg-lime-500 text-white' : 'bg-white/60'}`} title={settings.party ? "Disable party mode" : "Enable party mode"}>
                    💥<span className="text-sm">{settings.party ? 'Party ON' : 'Party'}</span>
                  </button>
                  <button type="button" onClick={() => { PARTY.megaShow(5000); if (settings.sfx){ SFX.unlock(); SFX.crazy(); } }} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-rose-500 text-white shadow hover:shadow-lg">
                    🎉 Test Party
                  </button>
                </span>
              </div>
            </header>

            <main className={`relative z-10 mx-auto max-w-7xl px-4 py-8 grid grid-cols-1 ${layoutCols} gap-6`}>
              {settings.showTeam && (
                <section>
                  <Panel title="Team" icon={"👥"}>
                    <TeamManager
                      team={team}
                      onToggle={(id) => setTeam(t => t.map(p => p.id === id ? ({ ...p, present: !p.present }) : p))}
                      onAdd={(name)=>{ const trimmed = (name || "").trim(); if (trimmed) setTeam(t => [{ id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9)), name: trimmed, present: true }, ...t]); }}
                      onRemove={(id)=>{ setTeam(t => t.filter(p => p.id !== id)); if(selectedPerson?.id===id) setSelectedPerson(null); }}
                      onSetAll={(present) => setTeam(t => t.map(p => ({ ...p, present })))}
                    />
                  </Panel>
                </section>
              )}

              <section>
                <Panel title="The Slots" icon={"🎉"}>
                  <div className="grid grid-cols-1 gap-6">
                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotName || "—"}
                        smallText={selectedPerson ? "On the spot!" : "Tap PICK to choose a person"}
                        emoji="👤"
                        highlight={Boolean(selectedPerson)}
                        spotlight={showSpotlight}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button type="button" onClick={pickRandomPersonSlot} disabled={slotPersonRunning || presentTeam.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotPersonRunning || presentTeam.length===0 ? "bg-amber-300 cursor-not-allowed" : "bg-amber-500"}`}>
                          🔀 Pick person
                        </button>
                      </div>
                    </div>

                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotText || "—"}
                        smallText={selectedQuestion ? "This is what we'd like to know from you" : "Tap SPIN to get a question"}
                        emoji="❓"
                        highlight={Boolean(selectedQuestion)}
                        spotlight={showQSpotlight}
                        spotlightIcon="❓"
                        spotlightSubtitle="This is what we'd like to know from you"
                        spotlightShowBig={false}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button type="button" onClick={pickRandomQuestionSlot} disabled={slotQuestionRunning || questions.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotQuestionRunning || questions.length===0 ? "bg-fuchsia-300 cursor-not-allowed" : "bg-fuchsia-600"}`}>
                          🔀 Spin question
                        </button>
                      </div>
                    </div>
                  </div>
                </Panel>
              </section>

              {settings.showQuestions && (
                <section>
                  <Panel title="Questions" icon={"🎉"}>
                    <QuestionsEditor questions={questions} setQuestions={setQuestions} />
                  </Panel>
                </section>
              )}
            </main>

            <footer className="mx-auto max-w-7xl px-4 pb-10 -mt-2 text-center text-xs text-slate-700 relative z-10">
              Nextview Wheel of Questions · Party Mode (no external confetti libs) · Built by ChatGPT
            </footer>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
