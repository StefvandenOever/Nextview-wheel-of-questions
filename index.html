<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Nextview Wheel of Questions ‚Äî Party Mode</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: {
      keyframes: {
        huepulse: { '0%, 100%': { filter: 'hue-rotate(0deg)' }, '50%': { filter: 'hue-rotate(45deg)' } },
        floaty: { '0%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-10px)' }, '100%': { transform: 'translateY(0px)' } },
        shimmer: { '0%': { backgroundPosition: '0% 50%' }, '100%': { backgroundPosition: '100% 50%' } }
      },
      animation: {
        huepulse: 'huepulse 6s ease-in-out infinite',
        floaty: 'floaty 4s ease-in-out infinite',
        shimmer: 'shimmer 12s linear infinite'
      }
    } } };</script>

    <!-- React + ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone (compile JSX in-browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- framer-motion (UMD) -->
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>

    <!-- canvas-confetti (UMD) -->
    <script src="https://unpkg.com/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <style>
      html, body, #root { height: 100%; }
      body { 
        background: linear-gradient(135deg, #fae8ff, #ffe4e6, #fde68a);
        background-size: 300% 300%;
      }
      .party-bg { 
        position: fixed; inset: -20vmax;
        background: radial-gradient(60vmax 60vmax at 10% 10%, rgba(255,255,255,.35), transparent 60%),
                    radial-gradient(60vmax 60vmax at 90% 30%, rgba(255,255,255,.25), transparent 60%),
                    radial-gradient(60vmax 60vmax at 50% 90%, rgba(255,255,255,.2), transparent 60%);
        pointer-events: none; z-index: 0;
      }
      #error-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,.6); color: #fff;
        display: none; align-items: center; justify-content: center; padding: 24px; z-index: 99999;
      }
      #error-overlay .box {
        max-width: 900px; width: 100%; background: rgba(255,255,255,.08);
        border: 1px solid rgba(255,255,255,.3); border-radius: 16px; padding: 20px;
      }
      #error-overlay pre { white-space: pre-wrap; word-break: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>
  <body class="min-h-screen">
    <div class="party-bg animate-shimmer"></div>
    <div id="root"></div>

    <!-- Friendly error overlay (so it's never a blank page) -->
    <div id="error-overlay"><div class="box">
      <div class="mb-2 font-semibold">An error occurred:</div>
      <pre id="error-text"></pre>
      <div class="text-xs opacity-80 mt-2">Open the browser console for details.</div>
    </div></div>
    <script>
      (function(){
        const overlay = document.getElementById('error-overlay');
        const txt = document.getElementById('error-text');
        window.addEventListener('error', (e) => {
          try { txt.textContent = String(e.error ? (e.error.stack || e.error) : e.message || e); } catch { txt.textContent = 'Unknown error'; }
          overlay.style.display = 'flex';
        });
        window.addEventListener('unhandledrejection', (e) => {
          try { txt.textContent = String(e.reason && e.reason.stack ? e.reason.stack : e.reason || e); } catch { txt.textContent = 'Unknown promise rejection'; }
          overlay.style.display = 'flex';
        });
      })();
    </script>

    <!-- App (compiled by Babel in the browser) -->
    <script type="text/babel" data-presets="env,react">
      const { useEffect, useMemo, useState } = React;

      const FM = window.framerMotion || window.FramerMotion || window.framermotion || null;
      const motion = FM ? FM.motion : new Proxy({}, { get: () => (props) => React.createElement('div', props, props && props.children) });
      const AnimatePresence = FM ? FM.AnimatePresence : ({ children }) => React.createElement(React.Fragment, null, children);

      const confetti = window.confetti || (() => {});
      const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      const Icon = ({ label, className, children }) => (
        <span aria-label={label} role="img" className={`inline-block align-middle ${className ?? ""}`}>
          {typeof children === "string" || typeof children === "number" ? children : String(children ?? "")}
        </span>
      );
      const Icons = {
        party: (cls) => <Icon label="party" className={cls}>üéâ</Icon>,
        users: (cls) => <Icon label="users" className={cls}>üë•</Icon>,
        plus: (cls) => <Icon label="add" className={cls}>Ôºã</Icon>,
        trash: (cls) => <Icon label="remove" className={cls}>üóëÔ∏è</Icon>,
        shuffle: (cls) => <Icon label="shuffle" className={cls}>üîÄ</Icon>,
        volOn: (cls) => <Icon label="volume on" className={cls}>üîä</Icon>,
        volOff: (cls) => <Icon label="volume off" className={cls}>üîá</Icon>,
        download: (cls) => <Icon label="download" className={cls}>‚¨áÔ∏è</Icon>,
        upload: (cls) => <Icon label="upload" className={cls}>‚¨ÜÔ∏è</Icon>,
        eye: (cls) => <Icon label="eye" className={cls}>üëÅÔ∏è</Icon>,
        eyeOff: (cls) => <Icon label="hide" className={cls}>üôà</Icon>,
        monitor: (cls) => <Icon label="test sound" className={cls}>üì±</Icon>,
        boom: (cls) => <Icon label="boom" className={cls}>üí•</Icon>,
      };

      const STORAGE_KEYS = { team: "woq_team_v4", questions: "woq_questions_v1", settings: "woq_settings_v5" };

      const DEFAULT_QUESTIONS = [
        "üòÄ What‚Äôs a small thing that made you smile recently?",
        "üçù What‚Äôs your go-to comfort food?",
        "üé¨ What‚Äôs a movie you can quote from memory?",
        "üåÖ Morning person or night owl?",
        "üéµ What‚Äôs a song that‚Äôs been stuck in your head?"
      ];
      const DEFAULT_TEAM = ["Alex","Jamie","Sam","Taylor"];

      class SoundEngine {
        constructor(){ this.ctx = null; }
        async unlock() {
          if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          if (this.ctx.state === "suspended") await this.ctx.resume();
          const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
          g.gain.value = 0.0001; o.connect(g).connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + 0.01);
        }
        tone({ freq = 880, dur = 0.08, type = "sine", vol = 0.06 } = {}) {
          if (!this.ctx) return;
          const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
          o.type = type; o.frequency.value = freq; o.connect(g).connect(this.ctx.destination);
          const now = this.ctx.currentTime;
          g.gain.setValueAtTime(vol, now); g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
          o.start(now); o.stop(now + dur);
        }
        tick(){ this.tone({ freq: 900, dur: 0.06, type: "triangle", vol: 0.05 }); }
        win(){ [660,880,1320].forEach((f,i)=>setTimeout(()=>this.tone({freq:f,dur:0.09,type:"sine",vol:0.06}), i*90)); }
        crazy(){ [220,330,440,550,660,770,880].forEach((f,i)=>setTimeout(()=>this.tone({freq:f,dur:0.05,type:"square",vol:0.07}), i*50)); }
      }
      const SFX = new SoundEngine();

      function Panel({ title, icon, children }){
        return (
          <div className="relative rounded-3xl bg-white/70 backdrop-blur border border-white/30 shadow-xl p-5 overflow-hidden">
            <div className="absolute -inset-32 bg-[conic-gradient(from_0deg,rgba(255,255,255,.25),transparent_30%,transparent_70%,rgba(255,255,255,.25))] animate-huepulse opacity-40"></div>
            <div className="relative flex items-center gap-2 mb-4">{icon}<h2 className="text-lg font-semibold">{title}</h2></div>
            <div className="relative">{children}</div>
          </div>
        );
      }

      function TeamManager({ team, onToggle, onAdd, onRemove, onSetAll }){
        const [name, setName] = useState("");
        const presentCount = team.filter(t => t.present).length;
        return (
          <div className="space-y-4">
            <div className="flex gap-2">
              <input value={name} onChange={(e) => setName(e.target.value)} onKeyDown={(e) => { if (e.key === "Enter") { onAdd(name); setName(""); } }} placeholder="Add teammate name" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-amber-400" />
              <button onClick={() => { onAdd(name); setName(""); }} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-amber-500 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
            </div>
            <div className="flex justify-between items-center text-sm text-slate-600">
              <span>Present: <strong>{presentCount}</strong> / {team.length}</span>
              <div className="flex gap-2">
                <button onClick={() => onSetAll(true)} className="px-3 py-1 rounded-full bg-emerald-500/90 text-white text-xs shadow">All present</button>
                <button onClick={() => onSetAll(false)} className="px-3 py-1 rounded-full bg-slate-400/90 text-white text-xs shadow">All away</button>
              </div>
            </div>
            <div className="max-h-[380px] overflow-auto pr-1">
              <ul className="divide-y divide-white/40">
                {team.map(p => (
                  <li key={p.id} className="flex items-center gap-3 py-2">
                    <input type="checkbox" checked={p.present} onChange={() => onToggle(p.id)} className="accent-emerald-600 w-4 h-4" />
                    <span className={`flex-1 ${p.present ? "" : "opacity-50"}`}>{p.name}</span>
                    <button onClick={() => onRemove(p.id)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove">{Icons.trash("text-base")}</button>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      function SlotCard({ bigText, smallText, emoji, highlight=false, spotlight=false }){
        return (
          <div className="relative flex-1">
            <div className={`relative w-full min-h-[240px] sm:min-h-[260px] rounded-3xl p-4 sm:p-6 bg-white/90 backdrop-blur border border-white/40 shadow-2xl ring-4 ${highlight ? 'ring-amber-300/70' : 'ring-white/30'}`}>
              <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_20%_20%,rgba(255,255,255,.6),transparent_40%),radial-gradient(circle_at_80%_30%,rgba(255,255,255,.35),transparent_45%)] rounded-3xl" />
              <div className="relative flex items-stretch gap-4 h-full">
                <div className="flex-shrink-0 w-20 sm:w-24 h-full min-h-[140px] grid place-items-center rounded-2xl bg-slate-100/80 border border-white/40 text-5xl select-none animate-floaty">
                  {emoji || 'üé∞'}
                </div>
                <div className="flex-1 grid place-items-center text-center px-2">
                  <div className="w-full">
                    {React.createElement(motion.div || 'div', {
                      key: bigText,
                      initial: { y: 8, opacity: 0, rotate: -0.5 },
                      animate: { y: 0, opacity: 1, rotate: 0 },
                      transition: { type: 'spring', stiffness: 500, damping: 30 },
                      className: "text-3xl sm:text-5xl md:text-6xl font-extrabold tracking-tight leading-tight md:leading-snug whitespace-pre-wrap break-words"
                    }, bigText)}
                    {smallText && React.createElement(motion.div || 'div', {
                      key: smallText,
                      initial: { opacity: 0 },
                      animate: { opacity: 1 },
                      transition: { duration: 0.25 },
                      className: "mt-3 text-slate-600 text-base sm:text-lg whitespace-pre-wrap break-words"
                    }, smallText)}
                  </div>
                </div>
              </div>
            </div>

            {React.createElement(AnimatePresence, null,
              spotlight ? React.createElement('div', { className:"absolute inset-0 rounded-3xl bg-black/40 backdrop-blur-sm flex items-center justify-center z-10" },
                React.createElement(motion.div || 'div', {
                  initial:{ scale: 0.9, rotate: -2 },
                  animate:{ scale: 1, rotate: 0 },
                  exit:{ scale: 0.95, opacity: 0 },
                  transition:{ type: 'spring', stiffness: 280, damping: 20 },
                  className:"px-8 py-6 rounded-3xl bg-white/95 border border-white/40 shadow-2xl text-center"
                },
                  React.createElement('div', { className:"text-5xl mb-2" }, "üëë"),
                  React.createElement('div', { className:"text-2xl font-extrabold tracking-wide" }, bigText),
                  React.createElement('div', { className:"mt-2 text-sm text-slate-500" }, "is on the spot!")
                )
              ) : null
            )}
          </div>
        );
      }

      // Party background (ambient confetti while enabled)
      function usePartyMachine(enabled){
        React.useEffect(() => {
          if (!enabled) return;
          let raf, id = 0;
          const colors = ["#ef4444","#f59e0b","#10b981","#3b82f6","#a855f7","#ec4899","#22c55e","#eab308"];
          const screen = () => ({ x: Math.random(), y: Math.random() * 0.3 });
          const burst = (opts={}) => confetti(Object.assign({ particleCount: 8 + Math.floor(Math.random()*10), spread: 40 + Math.random()*40, startVelocity: 45 + Math.random()*20, gravity: 0.9, ticks: 180 + Math.random()*100, origin: screen(), colors, scalar: 0.9 + Math.random()*0.6, drift: (Math.random()-0.5)*1.6 }, opts));
          const cannon = (x, angle) => confetti({ particleCount: 40, angle, spread: 70, startVelocity: 65, gravity: 0.9, origin: { x, y: 0.7 }, colors });
          const rain = () => confetti({ particleCount: 2, spread: 85, startVelocity: 35, gravity: 1.2, ticks: 280, origin: { x: Math.random(), y: -0.1 }, colors, drift: (Math.random()-0.5)*0.6 });

          const loop = () => {
            id++;
            if (id % 2 === 0) burst();
            if (id % 12 === 0){ cannon(0.08, 60); cannon(0.92, 120); }
            if (id % 3 === 0) rain();
            raf = requestAnimationFrame(loop);
          };
          raf = requestAnimationFrame(loop);
          return () => cancelAnimationFrame(raf);
        }, [enabled]);
      }

      function App(){
        const [team, setTeam] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.team);
          if (raw) return JSON.parse(raw);
          const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
          return DEFAULT_TEAM.map(n => ({ id: id(), name: n, present: true }));
        });
        const [questions, setQuestions] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.questions);
          return raw ? JSON.parse(raw) : DEFAULT_QUESTIONS;
        });
        const [settings, setSettings] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.settings);
          return raw ? JSON.parse(raw) : { sfx: true, showTeam: false, showQuestions: false, party: true };
        });

        const [selectedPerson, setSelectedPerson] = useState(null);
        const [selectedQuestion, setSelectedQuestion] = useState(null);

        const [slotPersonRunning, setSlotPersonRunning] = useState(false);
        const [slotQuestionRunning, setSlotQuestionRunning] = useState(false);

        const [slotName, setSlotName] = useState("");
        const [slotText, setSlotText] = useState("");

        const [showSpotlight, setShowSpotlight] = useState(false);

        React.useEffect(() => { localStorage.setItem(STORAGE_KEYS.team, JSON.stringify(team)); }, [team]);
        React.useEffect(() => { localStorage.setItem(STORAGE_KEYS.questions, JSON.stringify(questions)); }, [questions]);
        React.useEffect(() => { localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings)); }, [settings]);
        React.useEffect(() => {
          const handler = () => { SFX.unlock().catch(()=>{}); };
          window.addEventListener("pointerdown", handler, { once: true });
          return () => window.removeEventListener("pointerdown", handler);
        }, []);

        const presentTeam = React.useMemo(() => team.filter(t => t.present), [team]);

        usePartyMachine(settings.party);

        function CRAZY(duration = 4200) {
          const colors = ["#ef4444","#f59e0b","#10b981","#3b82f6","#a855f7","#ec4899","#22c55e","#eab308"];
          const end = Date.now() + duration;

          const corner = (x) => confetti({ particleCount: 180, spread: 70, origin: { x, y: 0.6 }, startVelocity: 65, ticks: 240, gravity: 0.8, colors });
          const starfield = () => {
            for (let i=0;i<8;i++){
              confetti({ particleCount: 24, angle: rand(0,360), spread: 70, origin: { x: Math.random(), y: Math.random()*0.6 }, startVelocity: 55, gravity: 0.9, ticks: 220, colors, scalar: 0.8 + Math.random()*0.8 });
            }
          };
          const comet = () => confetti({ particleCount: 1, startVelocity: 95, spread: 12, origin: { x: Math.random()*0.3, y: Math.random()*0.2 }, gravity: 1.1, ticks: 320, drift: 0.8 });
          corner(0.12); corner(0.88); starfield();
          (function frame(){
            confetti({ particleCount: 6, spread: 85, startVelocity: 45, gravity: 1.1, origin: { x: Math.random(), y: -0.1 }, ticks: 300, colors, drift: (Math.random()-0.5)*0.8 });
            if (Math.random() < 0.15) comet();
            if (Date.now() < end) requestAnimationFrame(frame);
          })();
        }

        function pickRandomPersonSlot(){
          if (!presentTeam.length || slotPersonRunning) return;
          setSelectedQuestion(null);
          setSlotPersonRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const p = presentTeam[i % presentTeam.length];
            setSlotName(p.name);
            if (settings.sfx) SFX.tick();
            if (settings.party && Math.random() < 0.15) confetti({ particleCount: 4, spread: 50, startVelocity: 35, origin: { x: Math.random(), y: 0.4 }, gravity: 1.0 });
            i++;
          }, 70);
          const stopAfter = rand(1800, 2600);
          setTimeout(() => {
            clearInterval(interval);
            const final = presentTeam[rand(0, presentTeam.length - 1)];
            setSlotName(final.name);
            setSelectedPerson(final);
            setSlotPersonRunning(false);
            setShowSpotlight(true);
            CRAZY(4600);
            if (settings.sfx) { SFX.win(); SFX.crazy(); }
            setTimeout(() => setShowSpotlight(false), 2600);
          }, stopAfter);
        }

        function pickRandomQuestionSlot(){
          if (!questions.length || slotQuestionRunning) return;
          setSlotQuestionRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const q = questions[i % questions.length];
            setSlotText(q);
            if (settings.sfx) SFX.tick();
            if (settings.party && Math.random() < 0.15) confetti({ particleCount: 4, spread: 50, startVelocity: 35, origin: { x: Math.random(), y: 0.2 }, gravity: 1.0 });
            i++;
          }, 70);
          const stopAfter = rand(1800, 2600);
          setTimeout(() => {
            clearInterval(interval);
            const index = rand(0, questions.length - 1);
            const final = questions[index];
            setSlotText(final);
            setSelectedQuestion(final);
            setSlotQuestionRunning(false);
            CRAZY(4800);
            if (settings.sfx) { SFX.win(); SFX.crazy(); }
          }, stopAfter);
        }

        function importData(file){
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const payload = JSON.parse(String(reader.result));
              if (Array.isArray(payload.team)) {
                const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
                setTeam(payload.team.map(n => ({
                  id: id(),
                  name: String(n.name ?? n),
                  present: Boolean(n.present ?? true)
                })));
              }
              if (Array.isArray(payload.questions)) setQuestions(payload.questions.map(String));
            } catch {
              alert("Couldn‚Äôt import JSON. Make sure it contains { team: [], questions: [] }...");
            }
          };
          reader.readAsText(file);
        }

        function exportData(){
          const blob = new Blob([JSON.stringify({ team: team.map(({ name, present }) => ({ name, present })), questions }, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "wheel-of-questions.json"; a.click(); URL.revokeObjectURL(url);
        }

        const layoutCols = settings.showTeam && settings.showQuestions ? "lg:grid-cols-3" : (settings.showTeam || settings.showQuestions) ? "lg:grid-cols-2" : "lg:grid-cols-1";

        return (
          <div className="min-h-screen w-full text-slate-800 relative">
            {/* Header */}
            <header className={`sticky top-0 z-30 backdrop-blur ${settings.party ? 'bg-gradient-to-r from-rose-200/60 via-amber-200/60 to-lime-200/60' : 'bg-white/40'} border-b border-white/20`}>
              <div className="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
                <img src="https://www.mulesoft.com/sites/default/files/2022-03/NEXTVIEW-logo-POS-COMPLETE-transparent.png" alt="Nextview Consulting" className={`h-7 object-contain ${settings.party ? 'animate-huepulse' : ''}`} />
                <h1 className="text-xl font-semibold">Nextview Wheel of Questions</h1>
                <span className="ml-auto flex items-center gap-2">
                  <button onMouseDown={() => SFX.unlock()} onClick={() => setSettings(s => ({ ...s, sfx: !s.sfx }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.sfx ? "Disable sounds" : "Enable sounds"}>
                    {settings.sfx ? Icons.volOn("text-base") : Icons.volOff("text-base")}<span className="text-sm">SFX</span>
                  </button>
                  <button onClick={() => { SFX.unlock(); if (settings.sfx) SFX.tick(); }} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Test sound">
                    {Icons.monitor("text-base")}<span className="text-sm">Test</span>
                  </button>
                  <button onClick={() => setSettings(s => ({ ...s, showTeam: !s.showTeam }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showTeam ? "Hide team" : "Show team"}>
                    {settings.showTeam ? Icons.eyeOff("text-base") : Icons.eye("text-base")}<span className="text-sm">Team</span>
                  </button>
                  <button onClick={() => setSettings(s => ({ ...s, showQuestions: !s.showQuestions }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showQuestions ? "Hide questions" : "Show questions"}>
                    {settings.showQuestions ? Icons.eyeOff("text-base") : Icons.eye("text-base")}<span className="text-sm">Questions</span>
                  </button>
                  <button onClick={exportData} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Export team & questions">
                    {Icons.download("text-base")}<span className="text-sm">Export</span>
                  </button>
                  <label className="cursor-pointer inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition">
                    {Icons.upload("text-base")}<span className="text-sm">Import</span>
                    <input type="file" accept="application/json" className="hidden" onChange={(e) => e.target.files && importData(e.target.files[0])} />
                  </label>
                  <button onClick={() => setSettings(s => ({ ...s, party: !s.party }))} className={`inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 shadow hover:shadow-lg transition ${settings.party ? 'bg-lime-500 text-white' : 'bg-white/60'}`} title={settings.party ? "Disable party mode" : "Enable party mode"}>
                    {Icons.boom("text-base")}<span className="text-sm">{settings.party ? 'Party ON' : 'Party'}</span>
                  </button>
                  <button onClick={() => { CRAZY(5000); if (settings.sfx){ SFX.unlock(); SFX.crazy(); } }} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-rose-500 text-white shadow hover:shadow-lg">
                    {Icons.party("text-base")} Test Party
                  </button>
                </span>
              </div>
            </header>

            <main className={`relative z-10 mx-auto max-w-7xl px-4 py-8 grid grid-cols-1 ${layoutCols} gap-6`}>
              {/* Team manager */}
              {settings.showTeam && (
                <section>
                  <Panel title="Team" icon={Icons.users("text-lg")}>
                    <TeamManager
                      team={team}
                      onToggle={(id) => setTeam(t => t.map(p => p.id === id ? ({ ...p, present: !p.present }) : p))}
                      onAdd={(name)=>{ const trimmed = (name || "").trim(); if (trimmed) setTeam(t => [{ id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9)), name: trimmed, present: true }, ...t]); }}
                      onRemove={(id)=>{ setTeam(t => t.filter(p => p.id !== id)); if(selectedPerson?.id===id) setSelectedPerson(null); }}
                      onSetAll={(present) => setTeam(t => t.map(p => ({ ...p, present })))}
                    />
                  </Panel>
                </section>
              )}

              {/* Slots */}
              <section>
                <Panel title="The Slots" icon={Icons.party("text-lg")}>
                  <div className="grid grid-cols-1 gap-6">
                    {/* Person Slot */}
                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotName || "‚Äî"}
                        smallText={selectedPerson ? "On the spot!" : "Tap PICK to choose a person"}
                        emoji="üë§"
                        highlight={Boolean(selectedPerson)}
                        spotlight={showSpotlight}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button onClick={pickRandomPersonSlot} disabled={slotPersonRunning || presentTeam.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotPersonRunning || presentTeam.length===0 ? "bg-amber-300 cursor-not-allowed" : "bg-amber-500"}`}>
                          {Icons.shuffle("text-base")} Pick person
                        </button>
                      </div>
                    </div>

                    {/* Question Slot */}
                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotText || "Tap SPIN to get a question"}
                        emoji="‚ùì"
                        highlight={Boolean(selectedQuestion)}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button onClick={pickRandomQuestionSlot} disabled={slotQuestionRunning || questions.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotQuestionRunning || questions.length===0 ? "bg-fuchsia-300 cursor-not-allowed" : "bg-fuchsia-600"}`}>
                          {Icons.shuffle("text-base")} Spin question
                        </button>
                      </div>
                    </div>
                  </div>
                </Panel>
              </section>

              {/* Questions editor */}
              {settings.showQuestions && (
                <section>
                  <Panel title="Questions" icon={Icons.party("text-lg")}>
                    <div className="space-y-3">
                      <div className="flex gap-2">
                        <input placeholder="Add a question (tip: start with an emoji!)" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-fuchsia-400" onKeyDown={(e)=>{
                          if (e.key === "Enter"){
                            const v = e.currentTarget.value.trim();
                            if (v){ setQuestions(q => [v, ...q]); e.currentTarget.value = ""; }
                          }
                        }} />
                        <button onClick={()=>{
                          const el = document.querySelector('[placeholder^="Add a question"]');
                          const v = (el?.value||'').trim();
                          if (!v) return;
                          setQuestions(q => [v, ...q]); el.value = '';
                        }} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-fuchsia-600 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
                      </div>
                      <div className="flex justify-between items-center text-sm text-slate-600">
                        <span>{questions.length} questions</span>
                        <button onClick={()=>{ if (confirm('Replace with defaults?')) setQuestions(DEFAULT_QUESTIONS); }} className="px-3 py-1 rounded-full bg-slate-500/90 text-white text-xs shadow">Reset defaults</button>
                      </div>
                      <div className="max-h-[380px] overflow-auto pr-1">
                        <ul className="divide-y divide-white/40">
                          {questions.map((q, i) => (
                            <li key={i} className="flex items-start gap-3 py-2">
                              <span className="text-slate-500 text-xs mt-1">{i + 1}.</span>
                              <span className="flex-1 text-sm">{q}</span>
                              <button onClick={() => setQuestions(s => s.filter((_, idx) => idx !== i))} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove">{Icons.trash("text-base")}</button>
                            </li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </Panel>
                </section>
              )}
            </main>

            <footer className="mx-auto max-w-7xl px-4 pb-10 -mt-2 text-center text-xs text-slate-700 relative z-10">
              Nextview Wheel of Questions ¬∑ Party Mode for maximum confetti üéâ
            </footer>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
