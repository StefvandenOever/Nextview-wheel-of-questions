<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wheel of Questions</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f172a;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22d3ee;
      --success:#22c55e;
      --danger:#f43f5e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      background: radial-gradient(1200px 800px at 70% -10%, #15213c 0%, #0b1220 60%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(1200px,100%);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:24px;
    }
    @media (max-width: 900px){
      .app{grid-template-columns:1fr}
    }
    .card{
      background:linear-gradient(180deg, #111a32 0%, #0f172a 100%);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px;
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      padding:20px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:12px;
      color:#cbd5e1;
      font-weight:600;
      letter-spacing:.2px;
      text-transform:uppercase;
      font-size:12px;
    }
    .slot{
      position:relative;
      display:flex;
      align-items:center;
      gap:16px;
      border:1px dashed rgba(255,255,255,.15);
      border-radius:16px;
      padding:16px;
      min-height:96px;
      background:rgba(255,255,255,.02);
      overflow:hidden;
    }
    .slot .icon{
      flex:0 0 auto;
      width:60px;
      height:60px;
      display:grid;
      place-items:center;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .slot .content{
      flex:1 1 auto;
      display:grid;
      place-items:center; /* centers horizontally & vertically */
      text-align:center;
      padding:8px 4px;
      min-height:60px;
    }
    .name{
      font-size:28px;
      font-weight:800;
      line-height:1.1;
      letter-spacing:.2px;
      text-wrap:balance;
    }
    .question{
      font-size:20px;
      line-height:1.3;
      text-wrap:balance;
    }
    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    button{
      -webkit-tap-highlight-color: transparent;
      border:none;
      border-radius:14px;
      padding:12px 16px;
      color:#0b1220;
      font-weight:700;
      background:linear-gradient(180deg, #67e8f9, #22d3ee);
      box-shadow: 0 6px 20px rgba(34,211,238,.35), inset 0 1px 0 rgba(255,255,255,.4);
      cursor:pointer;
    }
    button.secondary{
      background:linear-gradient(180deg, #e2e8f0, #cbd5e1);
      box-shadow: 0 6px 20px rgba(148,163,184,.25), inset 0 1px 0 rgba(255,255,255,.5);
    }
    button:active{transform:translateY(1px)}
    .wheel-wrap{
      position:relative;
      aspect-ratio:1/1;
      width:100%;
      max-width:560px;
      margin-inline:auto;
    }
    canvas#wheel{width:100%; height:100%}
    .pin{
      position:absolute;
      top:-6px; left:50%;
      transform:translateX(-50%);
      width:0; height:0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 24px solid var(--accent);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .label{
      text-align:center;
      margin-top:10px;
      color:var(--muted);
      font-size:14px;
    }
    .toast{
      position:fixed; inset:auto 16px 16px 16px;
      max-width:560px;
      margin:0 auto;
      padding:12px 14px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(255,255,255,.12);
      color:#e2e8f0;
      border-radius:12px;
      display:none;
    }
    .ribbon{
      position:absolute; inset:0;
      pointer-events:none;
    }
    .confetti{position:absolute; inset:0; pointer-events:none;}
  </style>
</head>
<body>
<div class="app">
  <div class="card">
    <div class="title">Team member</div>
    <div class="slot" id="name-slot" aria-live="polite">
      <div class="icon"><img src="assets/person-outline.svg" width="60" height="60" alt="Person icon"></div>
      <div class="content"><div class="name" id="name">‚Äî</div></div>
    </div>

    <div style="height:16px"></div>

    <div class="title">Question</div>
    <div class="slot" id="question-slot" aria-live="polite">
      <div class="icon"><img src="assets/question-outline.svg" width="60" height="60" alt="Question icon"></div>
      <div class="content"><div class="question" id="question">Spin the wheel to get a question!</div></div>
    </div>

    <div class="controls">
      <button id="spin">üéØ Spin</button>
      <button class="secondary" id="newName">üë§ New name</button>
      <button class="secondary" id="newQuestion">‚ùì New question</button>
      <button class="secondary" id="reset">‚ôªÔ∏è Reset (allow repeats)</button>
    </div>
    <div class="label">Tip: add your own lists in <code>/data/colleagues.json</code> and <code>/data/questions.json</code>.</div>
  </div>

  <div class="card">
    <div class="wheel-wrap">
      <canvas id="wheel" width="900" height="900"></canvas>
      <div class="pin" aria-hidden="true"></div>
      <canvas id="confetti" class="confetti"></canvas>
    </div>
    <div class="label">Wheel shows names; the slot shows both selections clearly centered.</div>
  </div>
</div>

<div class="toast" id="toast" role="status"></div>

<script>
// --- Data loading ---
async function loadJSON(path, fallback){
  try{
    const res = await fetch(path, {cache:'no-store'});
    if(!res.ok) throw new Error(res.statusText);
    return await res.json();
  }catch(e){
    console.warn('Using fallback for', path, e);
    return fallback;
  }
}
const fallbackNames = ["Stef", "Maya", "Jonas", "Aisha", "Luca", "Sven", "Nina", "Zo√´", "Ibrahim", "Kat", "Hannah", "Arne"];
const fallbackQuestions = ["What‚Äôs a small daily habit that makes your day better?", "If you could master one skill overnight, what would it be?", "What‚Äôs a food combo you secretly love?", "What song always boosts your mood?", "Which movie have you watched the most times ‚Äî and why?", "What‚Äôs a totally irrational fear you have?", "What‚Äôs your most-used app that isn‚Äôt email or chat?", "What‚Äôs a tiny win from this week you‚Äôre proud of?", "Coffee order? Be specific.", "What‚Äôs a place you‚Äôd love to work from for a month?", "What‚Äôs your favorite board or card game?", "What was your first job, and what did it teach you?"];

let NAMES = [];
let QUESTIONS = [];
let usedNames = new Set();
let usedQuestions = new Set();

function sampleNoRepeat(list, usedSet){
  if(usedSet.size >= list.length) return null;
  let pick;
  do { pick = list[Math.floor(Math.random()*list.length)]; } while(usedSet.has(pick));
  usedSet.add(pick);
  return pick;
}
function resetUsed(){
  usedNames.clear();
  usedQuestions.clear();
  toast('Reset done. Items can repeat again.');
}

// --- UI ---
const elName = document.getElementById('name');
const elQ = document.getElementById('question');
const btnSpin = document.getElementById('spin');
const btnNewName = document.getElementById('newName');
const btnNewQ = document.getElementById('newQuestion');
const btnReset = document.getElementById('reset');
const toastEl = document.getElementById('toast');

function toast(msg){
  toastEl.textContent = msg;
  toastEl.style.display = 'block';
  setTimeout(()=>{ toastEl.style.display='none'; }, 1800);
}

// --- Wheel drawing & spin ---
const wheel = document.getElementById('wheel');
const ctx = wheel.getContext('2d');
let currentAngle = 0;
let spinning = false;

function drawWheel(names){
  const n = Math.max(1, names.length);
  const center = wheel.width/2;
  ctx.clearRect(0,0,wheel.width,wheel.height);

  for(let i=0;i<n;i++){
    const start = (i/n)*Math.PI*2 + currentAngle;
    const end = ((i+1)/n)*Math.PI*2 + currentAngle;
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center, center-6, start, end);
    ctx.closePath();
    // alternating colors without external libs
    const light = i%2===0 ? '#1f2a44' : '#18223a';
    ctx.fillStyle = light;
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,.08)';
    ctx.lineWidth = 2;
    ctx.stroke();

    // text
    const mid = (start+end)/2;
    const r = center*0.72;
    const x = center + Math.cos(mid)*r;
    const y = center + Math.sin(mid)*r;
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(mid + Math.PI/2);
    ctx.fillStyle = '#e5e7eb';
    ctx.font = 'bold 28px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    const label = (names[i] || '').toString();
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    // wrap if needed
    let drawLabel = label;
    if(label.length > 14){
      const a = label.slice(0, label.length/2).trim();
      const b = label.slice(label.length/2).trim();
      ctx.fillText(a, 0, -14);
      ctx.fillText(b, 0, 14);
    }else{
      ctx.fillText(drawLabel, 0, 0);
    }
    ctx.restore();
  }

  // center cap
  ctx.beginPath();
  ctx.arc(center,center, 80, 0, Math.PI*2);
  ctx.fillStyle = '#0f172a';
  ctx.fill();
  ctx.strokeStyle = 'rgba(255,255,255,.2)';
  ctx.lineWidth = 3;
  ctx.stroke();

  // center text
  ctx.fillStyle = '#67e8f9';
  ctx.font = '700 26px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText('Spin!', center, center);
}

function spinToIndex(index, names){
  if(spinning) return;
  spinning = true;
  const n = names.length;
  // angle per slice
  const slice = (Math.PI*2)/n;
  // we want the picked index to end under the top pin (angle= -PI/2)
  // current target angle for slice center
  const target = -Math.PI/2 - (index+0.5)*slice;
  // add rotations
  const rotations = Math.PI*2* (4 + Math.random()*2);
  const finalAngle = target - rotations;

  const start = currentAngle;
  const duration = 2200 + Math.random()*800;
  const startTime = performance.now();

  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

  function tick(now){
    const t = Math.min(1, (now - startTime)/duration);
    const eased = easeOutCubic(t);
    currentAngle = start + (finalAngle - start)*eased;
    drawWheel(names);
    if(t < 1){ requestAnimationFrame(tick); }
    else {
      spinning = false;
      currentAngle = ((currentAngle % (Math.PI*2)) + Math.PI*2)%(Math.PI*2);
      celebrate();
    }
  }
  requestAnimationFrame(tick);
}

// --- Confetti ---
const confettiCanvas = document.getElementById('confetti');
const cctx = confettiCanvas.getContext('2d');
function resizeConfetti(){
  confettiCanvas.width = confettiCanvas.clientWidth;
  confettiCanvas.height = confettiCanvas.clientHeight;
}
window.addEventListener('resize', resizeConfetti);
resizeConfetti();
let confettiParticles = [];
function celebrate(){
  // generate
  const count = 120;
  confettiParticles = Array.from({length:count}).map(()=> ({
    x: confettiCanvas.width/2 + (Math.random()-0.5)*100,
    y: -20,
    vx: (Math.random()-0.5)*6,
    vy: 4 + Math.random()*3,
    r: 3 + Math.random()*4,
    a: Math.random()*Math.PI*2,
    s: 0.02 + Math.random()*0.06,
  }));
  let frame = 0;
  function draw(){
    frame++;
    cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    for(const p of confettiParticles){
      p.x += p.vx;
      p.y += p.vy;
      p.a += p.s;
      cctx.save();
      cctx.translate(p.x,p.y);
      cctx.rotate(p.a);
      cctx.fillStyle = ['#22d3ee','#f472b6','#fb923c','#a78bfa','#34d399'][Math.floor(Math.random()*5)];
      cctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
      cctx.restore();
    }
    if(frame < 120) requestAnimationFrame(draw);
  }
  draw();
}

// --- App logic ---
async function init(){
  NAMES = await loadJSON('data/colleagues.json', fallbackNames);
  QUESTIONS = await loadJSON('data/questions.json', fallbackQuestions);
  drawWheel(NAMES);
  // first picks
  const firstName = sampleNoRepeat(NAMES, usedNames) || NAMES[0] || '‚Äî';
  const firstQ = sampleNoRepeat(QUESTIONS, usedQuestions) || 'Ready? Spin the wheel!';
  elName.textContent = firstName;
  elQ.textContent = firstQ;
}
init();

btnSpin.addEventListener('click', ()=>{
  if(!NAMES.length) return;
  // choose a name but keep slot centered content
  const idx = Math.floor(Math.random()*NAMES.length);
  const name = NAMES[idx];
  spinToIndex(idx, NAMES);
  // use no-repeat for name in slot, independent from visual wheel
  const unique = sampleNoRepeat(NAMES, usedNames) || name;
  elName.textContent = unique;
  // also choose a new question (no repeat)
  const q = sampleNoRepeat(QUESTIONS, usedQuestions) || QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)] || '‚Äî';
  elQ.textContent = q;
});

btnNewName.addEventListener('click', ()=>{
  const unique = sampleNoRepeat(NAMES, usedNames);
  if(unique){ elName.textContent = unique; celebrate(); }
  else toast('All names used. Hit Reset to allow repeats.');
});
btnNewQ.addEventListener('click', ()=>{
  const q = sampleNoRepeat(QUESTIONS, usedQuestions);
  if(q){ elQ.textContent = q; celebrate(); }
  else toast('All questions used. Hit Reset to allow repeats.');
});
btnReset.addEventListener('click', resetUsed);
</script>
</body>
</html>
