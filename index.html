<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Nextview Wheel of Questions</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: {} } };</script>

    <!-- React + ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone (compile JSX in-browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- framer-motion (UMD) -->
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>

    <!-- canvas-confetti (UMD) -->
    <script src="https://unpkg.com/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <style>
      html, body, #root { height: 100%; }
      body { background: linear-gradient(135deg, #fae8ff, #ffe4e6, #fde68a); }
      #error-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,.6); color: #fff;
        display: none; align-items: center; justify-content: center; padding: 24px; z-index: 99999;
      }
      #error-overlay .box {
        max-width: 900px; width: 100%; background: rgba(255,255,255,.08);
        border: 1px solid rgba(255,255,255,.3); border-radius: 16px; padding: 20px;
      }
      #error-overlay pre { white-space: pre-wrap; word-break: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>
  <body class="min-h-screen">
    <div id="root"></div>

    <!-- Friendly error overlay (so it's never a blank page) -->
    <div id="error-overlay"><div class="box">
      <div class="mb-2 font-semibold">An error occurred:</div>
      <pre id="error-text"></pre>
      <div class="text-xs opacity-80 mt-2">Open the browser console for details.</div>
    </div></div>
    <script>
      (function(){
        const overlay = document.getElementById('error-overlay');
        const txt = document.getElementById('error-text');
        window.addEventListener('error', (e) => {
          try { txt.textContent = String(e.error ? (e.error.stack || e.error) : e.message || e); } catch { txt.textContent = 'Unknown error'; }
          overlay.style.display = 'flex';
        });
        window.addEventListener('unhandledrejection', (e) => {
          try { txt.textContent = String(e.reason && e.reason.stack ? e.reason.stack : e.reason || e); } catch { txt.textContent = 'Unknown promise rejection'; }
          overlay.style.display = 'flex';
        });
      })();
    </script>

    <!-- App (compiled by Babel in the browser) -->
    <script type="text/babel" data-presets="env,react">
      const { useEffect, useMemo, useState } = React;

      // Robustly grab framer-motion globals, with no-op fallbacks
      const FM = window.framerMotion || window.FramerMotion || window.framermotion || null;
      const motion = FM ? FM.motion : new Proxy({}, { get: () => (props) => React.createElement('div', props, props && props.children) });
      const AnimatePresence = FM ? FM.AnimatePresence : ({ children }) => React.createElement(React.Fragment, null, children);

      // Confetti fallback
      const confetti = window.confetti || (() => {});

      // Utils
      const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      // Icons (emoji-based, zero deps)
      const Icon = ({ label, className, children }) => (
        <span aria-label={label} role="img" className={`inline-block align-middle ${className ?? ""}`}>
          {typeof children === "string" || typeof children === "number" ? children : String(children ?? "")}
        </span>
      );
      const Icons = {
        party: (cls) => <Icon label="party" className={cls}>üéâ</Icon>,
        users: (cls) => <Icon label="users" className={cls}>üë•</Icon>,
        plus: (cls) => <Icon label="add" className={cls}>Ôºã</Icon>,
        trash: (cls) => <Icon label="remove" className={cls}>üóëÔ∏è</Icon>,
        shuffle: (cls) => <Icon label="shuffle" className={cls}>üîÄ</Icon>,
        volOn: (cls) => <Icon label="volume on" className={cls}>üîä</Icon>,
        volOff: (cls) => <Icon label="volume off" className={cls}>üîá</Icon>,
        download: (cls) => <Icon label="download" className={cls}>‚¨áÔ∏è</Icon>,
        upload: (cls) => <Icon label="upload" className={cls}>‚¨ÜÔ∏è</Icon>,
        eye: (cls) => <Icon label="eye" className={cls}>üëÅÔ∏è</Icon>,
        eyeOff: (cls) => <Icon label="hide" className={cls}>üôà</Icon>,
        monitor: (cls) => <Icon label="test sound" className={cls}>üì±</Icon>,
      };

      // Storage keys
      const STORAGE_KEYS = { team: "woq_team_v4", questions: "woq_questions_v1", settings: "woq_settings_v4" };

      // Defaults
      const DEFAULT_QUESTIONS = [
        "üòÄ What‚Äôs a small thing that made you smile recently?",
        "üçù What‚Äôs your go-to comfort food?",
        "‚òï Coffee, tea, or something else ‚Äî what and how do you take it?",
        "üß© What‚Äôs a hobby you picked up lately?",
        "üé¨ What‚Äôs a movie you can quote from memory?",
        "üåÖ Morning person or night owl?",
        "üó∫Ô∏è If you could teleport anywhere for dinner tonight, where would you go?",
        "üéµ What‚Äôs a song that‚Äôs been stuck in your head?",
        "üìç What‚Äôs your favorite local spot in your city?",
        "üìö What‚Äôs a book you recommend to almost everyone?",
        "üì± What‚Äôs an app you love that others might not know?",
        "üòä What‚Äôs your most-used emoji?",
        "üé§ If you had a talk show, who‚Äôs your first guest?",
        "üçç Pineapple on pizza ‚Äî yay or nay?",
        "üë∂ What was your first job?",
        "üõ†Ô∏è What‚Äôs a skill you‚Äôd love to learn this year?",
        "üõèÔ∏è What‚Äôs your ideal way to start a Saturday?",
        "‚úàÔ∏è What‚Äôs a travel destination still on your list?",
        "üé≤ What‚Äôs your favorite board or video game?",
        "üç£ What‚Äôs a food you‚Äôll never get tired of?",
        "üê∂ Dogs, cats, or‚Ä¶?",
        "üí° What‚Äôs a tiny work hack that helps you a lot?",
        "üì∫ What‚Äôs your guilty-pleasure TV show?",
        "üçÅ What‚Äôs your favorite season and why?",
        "üé∂ If your life had a theme song, what would it be?",
        "üí∂ What‚Äôs your best purchase under ‚Ç¨50?",
        "üèÜ What‚Äôs something you‚Äôre proud of this month?",
        "üèîÔ∏è Mountains or beach?",
        "üì∏ What‚Äôs the last photo you took on your phone? (Describe it)",
        "üßò What‚Äôs your favorite way to recharge after work?",
        "üáÆüáπ What‚Äôs a cuisine you could eat for a week straight?",
        "üç™ What‚Äôs a childhood snack you still love?",
        "üìà What‚Äôs a small habit you‚Äôre trying to build?",
        "üß™ What was your favorite subject in school?",
        "üèôÔ∏è What‚Äôs a city you‚Äôd happily live in for a year?",
        "üéß What‚Äôs a podcast you enjoy?",
        "ü•ê Sweet or savory breakfast?",
        "‚ö° What‚Äôs a tiny thing that instantly improves your day?",
        "‚úàÔ∏è What‚Äôs a memorable trip you‚Äôve taken?",
        "üé• What‚Äôs a movie you wish you could watch again for the first time?",
        "üèÉ Are you into any sports (watching or playing)?",
        "üç® What‚Äôs your favorite ice cream flavor?",
        "üîé What‚Äôs something you collect or would like to collect?",
        "‚ú® Who or what inspires you lately?",
        "üé§ What‚Äôs your go-to karaoke song?",
        "ü™¥ What‚Äôs your favorite indoor plant?",
        "üì∫ What‚Äôs your comfort TV series?",
        "üñ•Ô∏è What‚Äôs a tech gadget you love?",
        "üëç What‚Äôs a positive work habit you admire in others?",
        "üè° Share a fun fact about your hometown.",
        "üëÉ What‚Äôs a smell that brings back good memories?",
        "üç≥ Are you into cooking ‚Äî signature dish?",
        "üó£Ô∏è What‚Äôs a language you‚Äôd like to learn?",
        "üé≤ What‚Äôs a small risk you took that paid off?",
        "üö∂ What‚Äôs your favorite way to move (walk, run, dance‚Ä¶)?",
        "üé® What‚Äôs a creative pursuit you enjoy?",
        "üéâ What‚Äôs a tradition you love?",
        "üéÑ What‚Äôs your favorite public holiday and why?",
        "üìù What‚Äôs a piece of advice you come back to?",
        "üï≥Ô∏è What‚Äôs a YouTube rabbit hole you‚Äôve fallen into?",
        "ü•® What‚Äôs a snack you always keep at home?",
        "ü•™ Early lunch or late lunch?",
        "üß≠ What‚Äôs one item on your bucket list this year?",
        "üìå What‚Äôs a habit you‚Äôre proud of keeping?",
        "üó∫Ô∏è What‚Äôs your ideal vacation: plan-everything or go-with-the-flow?",
        "üß† What‚Äôs a niche interest you could talk about for hours?",
        "‚è≥ If you could time-travel for a day, where/when would you go?",
        "ü§ù What‚Äôs a small act of kindness you‚Äôve experienced?",
        "üåßÔ∏è What‚Äôs your favorite rainy-day activity?",
        "üçΩÔ∏è What‚Äôs a local restaurant you love?",
        "üé∏ If you could instantly master a musical instrument, which one?",
        "üèòÔ∏è What‚Äôs your favorite thing about your current city?",
        "ü•ó What‚Äôs a food you didn‚Äôt like but now love?",
        "üóìÔ∏è What‚Äôs a weekend ritual you look forward to?",
        "üì± What‚Äôs your most-used app on your phone?",
        "üé≤ What‚Äôs a childhood game you loved?",
        "üöÄ What‚Äôs a productivity tip that actually works for you?",
        "ü¶ä If you had a mascot, what would it be?",
        "üß¥ What‚Äôs a small luxury you enjoy?",
        "üéº What‚Äôs a movie soundtrack you love?",
        "üç≥ What‚Äôs a dish you‚Äôve perfected?",
        "üõ´ Window seat or aisle seat?",
        "üôè What‚Äôs a tiny thing you‚Äôre grateful for today?",
        "üë®‚Äçüë©‚Äçüëß What‚Äôs a tradition from your family you‚Äôd keep forever?",
        "ü•û What‚Äôs your favorite breakfast?",
        "üì∫ What‚Äôs a series you recommend right now?",
        "üé´ If you could attend any live event, what would it be?",
        "üè´ What‚Äôs a skill you wish was taught in school?",
        "üç∞ What‚Äôs your favorite dessert?",
        "üïØÔ∏è What‚Äôs a scent you love (candle, perfume, etc.)?",
        "üß∞ What‚Äôs a life hack you actually use?",
        "üå≥ What‚Äôs your favorite park or nature spot nearby?",
        "üéØ What‚Äôs a small goal you‚Äôre working on?",
      ];
      const DEFAULT_TEAM = ["Alex", "Jamie", "Sam", "Taylor", "Jordan", "Casey", "Riley", "Morgan"];

      // Sound engine
      class SoundEngine {
        constructor(){ this.ctx = null; }
        async unlock() {
          if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          if (this.ctx.state === "suspended") await this.ctx.resume();
          const o = this.ctx.createOscillator();
          const g = this.ctx.createGain();
          g.gain.value = 0.0001; o.connect(g).connect(this.ctx.destination);
          o.start(); o.stop(this.ctx.currentTime + 0.01);
        }
        tone({ freq = 880, dur = 0.08, type = "sine", vol = 0.06 } = {}) {
          if (!this.ctx) return;
          const o = this.ctx.createOscillator();
          const g = this.ctx.createGain();
          o.type = type; o.frequency.value = freq;
          o.connect(g).connect(this.ctx.destination);
          const now = this.ctx.currentTime;
          g.gain.setValueAtTime(vol, now);
          g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
          o.start(now); o.stop(now + dur);
        }
        tick(){ this.tone({ freq: 900, dur: 0.06, type: "triangle", vol: 0.05 }); }
        win(){ [660,880,1320].forEach((f,i)=>setTimeout(()=>this.tone({freq:f,dur:0.09,type:"sine",vol:0.06}), i*90)); }
      }
      const SFX = new SoundEngine();

      // Reusable UI
      function Panel({ title, icon, children }){
        return (
          <div className="rounded-3xl bg-white/70 backdrop-blur border border-white/30 shadow-xl p-5">
            <div className="flex items-center gap-2 mb-4">{icon}<h2 className="text-lg font-semibold">{title}</h2></div>
            {children}
          </div>
        );
      }

      function TeamManager({ team, onToggle, onAdd, onRemove, onSetAll }){
        const [name, setName] = useState("");
        const presentCount = team.filter(t => t.present).length;
        return (
          <div className="space-y-4">
            <div className="flex gap-2">
              <input value={name} onChange={(e) => setName(e.target.value)} onKeyDown={(e) => { if (e.key === "Enter") { onAdd(name); setName(""); } }} placeholder="Add teammate name" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-amber-400" />
              <button onClick={() => { onAdd(name); setName(""); }} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-amber-500 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
            </div>
            <div className="flex justify-between items-center text-sm text-slate-600">
              <span>Present: <strong>{presentCount}</strong> / {team.length}</span>
              <div className="flex gap-2">
                <button onClick={() => onSetAll(true)} className="px-3 py-1 rounded-full bg-emerald-500/90 text-white text-xs shadow">All present</button>
                <button onClick={() => onSetAll(false)} className="px-3 py-1 rounded-full bg-slate-400/90 text-white text-xs shadow">All away</button>
              </div>
            </div>
            <div className="max-h-[380px] overflow-auto pr-1">
              <ul className="divide-y divide-white/40">
                {team.map(p => (
                  <li key={p.id} className="flex items-center gap-3 py-2">
                    <input type="checkbox" checked={p.present} onChange={() => onToggle(p.id)} className="accent-emerald-600 w-4 h-4" />
                    <span className={`flex-1 ${p.present ? "" : "opacity-50"}`}>{p.name}</span>
                    <button onClick={() => onRemove(p.id)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove">{Icons.trash("text-base")}</button>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      // Slot card: left emoji panel + centered content + spotlight overlay
      function SlotCard({ bigText, smallText, emoji, highlight=false, spotlight=false }){
        return (
          <div className="relative flex-1">
            <div className={`relative w-full min-h-[240px] sm:min-h-[260px] rounded-3xl p-4 sm:p-6 bg-white/90 backdrop-blur border border-white/40 shadow-2xl ring-4 ${highlight ? 'ring-amber-300/70' : 'ring-white/30'}`}>
              <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_20%_20%,rgba(255,255,255,.6),transparent_40%),radial-gradient(circle_at_80%_30%,rgba(255,255,255,.35),transparent_45%)] rounded-3xl" />
              <div className="relative flex items-stretch gap-4 h-full">
                <div className="flex-shrink-0 w-20 sm:w-24 h-full min-h-[140px] grid place-items-center rounded-2xl bg-slate-100/80 border border-white/40 text-5xl select-none">
                  {emoji || 'üé∞'}
                </div>
                <div className="flex-1 grid place-items-center text-center px-2">
                  <div className="w-full">
                    {React.createElement(motion.div || 'div', {
                      key: bigText,
                      initial: { y: 8, opacity: 0 },
                      animate: { y: 0, opacity: 1 },
                      transition: { type: 'spring', stiffness: 500, damping: 30 },
                      className: "text-3xl sm:text-5xl md:text-6xl font-extrabold tracking-tight leading-tight md:leading-snug whitespace-pre-wrap break-words"
                    }, bigText)}
                    {smallText && React.createElement(motion.div || 'div', {
                      key: smallText,
                      initial: { opacity: 0 },
                      animate: { opacity: 1 },
                      transition: { duration: 0.25 },
                      className: "mt-3 text-slate-600 text-base sm:text-lg whitespace-pre-wrap break-words"
                    }, smallText)}
                  </div>
                </div>
              </div>
            </div>

            {React.createElement(AnimatePresence, null,
              spotlight ? React.createElement('div', { className:"absolute inset-0 rounded-3xl bg-black/40 backdrop-blur-sm flex items-center justify-center z-10" },
                React.createElement(motion.div || 'div', {
                  initial:{ scale: 0.9, rotate: -2 },
                  animate:{ scale: 1, rotate: 0 },
                  exit:{ scale: 0.95, opacity: 0 },
                  transition:{ type: 'spring', stiffness: 280, damping: 20 },
                  className:"px-8 py-6 rounded-3xl bg-white/95 border border-white/40 shadow-2xl text-center"
                },
                  React.createElement('div', { className:"text-5xl mb-2" }, "üëë"),
                  React.createElement('div', { className:"text-2xl font-extrabold tracking-wide" }, bigText),
                  React.createElement('div', { className:"mt-2 text-sm text-slate-500" }, "is on the spot!")
                )
              ) : null
            )}
          </div>
        );
      }

      function QuestionsEditor({ questions, setQuestions }){
        const [draft, setDraft] = useState("");
        function addQuestion(q){ const t = (q||"").trim(); if (!t) return; setQuestions([t, ...questions]); setDraft(""); }
        function removeQuestion(idx){ setQuestions(questions.filter((_, i) => i !== idx)); }
        function resetDefaults(){ if (confirm("Replace all questions with the default set?")) setQuestions(DEFAULT_QUESTIONS); }
        return (
          <div className="space-y-3">
            <div className="flex gap-2">
              <input value={draft} onChange={(e) => setDraft(e.target.value)} onKeyDown={(e) => e.key === "Enter" && addQuestion(draft)} placeholder="Add a question (tip: start with an emoji!)" className="flex-1 rounded-2xl px-4 py-2 bg-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-fuchsia-400" />
              <button onClick={() => addQuestion(draft)} className="inline-flex items-center gap-2 rounded-2xl px-4 py-2 bg-fuchsia-600 text-white shadow hover:shadow-lg">{Icons.plus("text-base")} Add</button>
            </div>
            <div className="flex justify-between items-center text-sm text-slate-600">
              <span>{questions.length} questions</span>
              <button onClick={resetDefaults} className="px-3 py-1 rounded-full bg-slate-500/90 text-white text-xs shadow">Reset defaults</button>
            </div>
            <div className="max-h-[380px] overflow-auto pr-1">
              <ul className="divide-y divide-white/40">
                {questions.map((q, i) => (
                  <li key={i} className="flex items-start gap-3 py-2">
                    <span className="text-slate-500 text-xs mt-1">{i + 1}.</span>
                    <span className="flex-1 text-sm">{q}</span>
                    <button onClick={() => removeQuestion(i)} className="p-1.5 rounded-full hover:bg-rose-100/60" title="Remove">{Icons.trash("text-base")}</button>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      // App
      function App(){
        const [team, setTeam] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.team);
          if (raw) return JSON.parse(raw);
          const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
          return DEFAULT_TEAM.map(n => ({ id: id(), name: n, present: true }));
        });
        const [questions, setQuestions] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.questions);
          return raw ? JSON.parse(raw) : DEFAULT_QUESTIONS;
        });
        const [settings, setSettings] = useState(() => {
          const raw = localStorage.getItem(STORAGE_KEYS.settings);
          return raw ? JSON.parse(raw) : { sfx: true, showTeam: false, showQuestions: false };
        });

        const [selectedPerson, setSelectedPerson] = useState(null);
        const [selectedQuestion, setSelectedQuestion] = useState(null);

        const [slotPersonRunning, setSlotPersonRunning] = useState(false);
        const [slotQuestionRunning, setSlotQuestionRunning] = useState(false);

        const [slotName, setSlotName] = useState("");
        const [slotText, setSlotText] = useState("");

        const [showSpotlight, setShowSpotlight] = useState(false);

        useEffect(() => { localStorage.setItem(STORAGE_KEYS.team, JSON.stringify(team)); }, [team]);
        useEffect(() => { localStorage.setItem(STORAGE_KEYS.questions, JSON.stringify(questions)); }, [questions]);
        useEffect(() => { localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings)); }, [settings]);
        useEffect(() => {
          const handler = () => { SFX.unlock().catch(()=>{}); };
          window.addEventListener("pointerdown", handler, { once: true });
          return () => window.removeEventListener("pointerdown", handler);
        }, []);

        const presentTeam = useMemo(() => team.filter(t => t.present), [team]);

        // Confetti party
        function megaParty(duration = 3800) {
          const end = Date.now() + duration;
          const colors = ["#ef4444","#f59e0b","#10b981","#3b82f6","#a855f7","#ec4899"];
          (function frame(){
            confetti({ particleCount: 4 + Math.floor(Math.random()*6), angle: 60 + Math.random()*60, spread: 70 + Math.random()*20, startVelocity: 55 + Math.random()*30, gravity: 0.7, ticks: 260, origin: { x: Math.random(), y: Math.random() * 0.3 }, colors, scalar: 0.9 + Math.random()*0.6, drift: (Math.random()-0.5)*1.2 });
            if (Date.now() < end) requestAnimationFrame(frame);
          })();
          confetti({ particleCount: 200, spread: 75, origin: { x: 0.1, y: 0.6 }, colors });
          confetti({ particleCount: 200, spread: 75, origin: { x: 0.9, y: 0.6 }, colors });
        }

        function pickRandomPersonSlot(){
          if (!presentTeam.length || slotPersonRunning) return;
          setSelectedQuestion(null);
          setSlotPersonRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const p = presentTeam[i % presentTeam.length];
            setSlotName(p.name);
            if (settings.sfx) SFX.tick();
            i++;
          }, 70);
          const stopAfter = rand(1800, 2600);
          setTimeout(() => {
            clearInterval(interval);
            const final = presentTeam[rand(0, presentTeam.length - 1)];
            setSlotName(final.name);
            setSelectedPerson(final);
            setSlotPersonRunning(false);
            setShowSpotlight(true);
            megaParty(3800);
            if (settings.sfx) SFX.win();
            setTimeout(() => setShowSpotlight(false), 2600);
          }, stopAfter);
        }

        function pickRandomQuestionSlot(){
          if (!questions.length || slotQuestionRunning) return;
          setSlotQuestionRunning(true);
          let i = 0;
          const interval = setInterval(() => {
            const q = questions[i % questions.length];
            setSlotText(q);
            if (settings.sfx) SFX.tick();
            i++;
          }, 70);
          const stopAfter = rand(1800, 2600);
          setTimeout(() => {
            clearInterval(interval);
            const index = rand(0, questions.length - 1);
            const final = questions[index];
            setSlotText(final);
            setSelectedQuestion(final);
            setSlotQuestionRunning(false);
            megaParty(4000);
            if (settings.sfx) SFX.win();
          }, stopAfter);
        }

        function importData(file){
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const payload = JSON.parse(String(reader.result));
              if (Array.isArray(payload.team)) {
                const id = () => (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9));
                setTeam(payload.team.map(n => ({
                  id: id(),
                  name: String(n.name ?? n),
                  present: Boolean(n.present ?? true)
                })));
              }
              if (Array.isArray(payload.questions)) setQuestions(payload.questions.map(String));
            } catch {
              alert("Couldn‚Äôt import JSON. Make sure it contains { team: [], questions: [] }.");
            }
          };
          reader.readAsText(file);
        }

        function exportData(){
          const blob = new Blob([JSON.stringify({ team: team.map(({ name, present }) => ({ name, present })), questions }, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "wheel-of-questions.json"; a.click(); URL.revokeObjectURL(url);
        }

        const layoutCols = settings.showTeam && settings.showQuestions ? "lg:grid-cols-3" : (settings.showTeam || settings.showQuestions) ? "lg:grid-cols-2" : "lg:grid-cols-1";

        return (
          <div className="min-h-screen w-full text-slate-800">
            {/* Header */}
            <header className="sticky top-0 z-30 backdrop-blur bg-white/40 border-b border-white/20">
              <div className="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
                <img src="https://www.mulesoft.com/sites/default/files/2022-03/NEXTVIEW-logo-POS-COMPLETE-transparent.png" alt="Nextview Consulting" className="h-7 object-contain" />
                <h1 className="text-xl font-semibold">Nextview Wheel of Questions</h1>
                <span className="ml-auto flex items-center gap-2">
                  <button onMouseDown={() => SFX.unlock()} onClick={() => setSettings(s => ({ ...s, sfx: !s.sfx }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.sfx ? "Disable sounds" : "Enable sounds"}>
                    {settings.sfx ? Icons.volOn("text-base") : Icons.volOff("text-base")}<span className="text-sm">SFX</span>
                  </button>
                  <button onClick={() => { SFX.unlock(); if (settings.sfx) SFX.tick(); }} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Test sound">
                    {Icons.monitor("text-base")}<span className="text-sm">Test</span>
                  </button>
                  <button onClick={() => setSettings(s => ({ ...s, showTeam: !s.showTeam }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showTeam ? "Hide team" : "Show team"}>
                    {settings.showTeam ? Icons.eyeOff("text-base") : Icons.eye("text-base")}<span className="text-sm">Team</span>
                  </button>
                  <button onClick={() => setSettings(s => ({ ...s, showQuestions: !s.showQuestions }))} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title={settings.showQuestions ? "Hide questions" : "Show questions"}>
                    {settings.showQuestions ? Icons.eyeOff("text-base") : Icons.eye("text-base")}<span className="text-sm">Questions</span>
                  </button>
                  <button onClick={exportData} className="inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition" title="Export team & questions">
                    {Icons.download("text-base")}<span className="text-sm">Export</span>
                  </button>
                  <label className="cursor-pointer inline-flex items-center gap-2 rounded-2xl px-3 py-1.5 bg-white/60 shadow-sm hover:shadow transition">
                    {Icons.upload("text-base")}<span className="text-sm">Import</span>
                    <input type="file" accept="application/json" className="hidden" onChange={(e) => e.target.files && importData(e.target.files[0])} />
                  </label>
                </span>
              </div>
            </header>

            <main className={`mx-auto max-w-7xl px-4 py-8 grid grid-cols-1 ${layoutCols} gap-6`}>
              {/* Team manager */}
              {settings.showTeam && (
                <section>
                  <Panel title="Team" icon={Icons.users("text-lg")}>
                    <TeamManager
                      team={team}
                      onToggle={(id) => setTeam(t => t.map(p => p.id === id ? ({ ...p, present: !p.present }) : p))}
                      onAdd={(name)=>{ const trimmed = (name || "").trim(); if (trimmed) setTeam(t => [{ id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random() * 1e9)), name: trimmed, present: true }, ...t]); }}
                      onRemove={(id)=>{ setTeam(t => t.filter(p => p.id !== id)); if(selectedPerson?.id===id) setSelectedPerson(null); }}
                      onSetAll={(present) => setTeam(t => t.map(p => ({ ...p, present })))}
                    />
                  </Panel>
                </section>
              )}

              {/* Slots */}
              <section>
                <Panel title="The Slots" icon={Icons.party("text-lg")}>
                  <div className="grid grid-cols-1 gap-6">
                    {/* Person Slot */}
                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotName || "‚Äî"}
                        smallText={selectedPerson ? "On the spot!" : "Tap PICK to choose a person"}
                        emoji="üë§"
                        highlight={Boolean(selectedPerson)}
                        spotlight={showSpotlight}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button onClick={pickRandomPersonSlot} disabled={slotPersonRunning || presentTeam.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotPersonRunning || presentTeam.length===0 ? "bg-amber-300 cursor-not-allowed" : "bg-amber-500"}`}>
                          {Icons.shuffle("text-base")} Pick person
                        </button>
                      </div>
                    </div>

                    {/* Question Slot */}
                    <div className="flex flex-col sm:flex-row items-stretch gap-4">
                      <SlotCard
                        bigText={slotText || "Tap SPIN to get a question"}
                        emoji="‚ùì"
                        highlight={Boolean(selectedQuestion)}
                      />
                      <div className="flex sm:flex-col gap-3 sm:w-40">
                        <button onClick={pickRandomQuestionSlot} disabled={slotQuestionRunning || questions.length===0} className={`flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow hover:shadow-lg active:translate-y-[1px] ${slotQuestionRunning || questions.length===0 ? "bg-fuchsia-300 cursor-not-allowed" : "bg-fuchsia-600"}`}>
                          {Icons.shuffle("text-base")} Spin question
                        </button>
                      </div>
                    </div>
                  </div>
                </Panel>
              </section>

              {/* Questions editor */}
              {settings.showQuestions && (
                <section>
                  <Panel title="Questions" icon={Icons.party("text-lg")}>
                    <QuestionsEditor questions={questions} setQuestions={setQuestions} />
                  </Panel>
                </section>
              )}
            </main>

            <footer className="mx-auto max-w-7xl px-4 pb-10 -mt-2 text-center text-xs text-slate-700">
              Nextview Wheel of Questions ¬∑ Export/Import to reuse your team & questions ¬∑ Use Team/Questions toggles for distraction‚Äëfree mode.
            </footer>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
